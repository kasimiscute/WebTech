<!--key=AIzaSyA-bbag18ICobNefhbhicgT-KDcdDG-GHs-->
<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <meta charset="utf-8">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
  <title>Cooperative Gesture Handling</title>
  <style>
    /* Always set the map height explicitly to define the size of the div
    * element that contains the map. */

    #map {
      height: 100%;
    }
    /* Optional: Makes the sample page fill the window. */

    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
  </style>
</head>

<body>
  <div id="map" style="width:500px;height:380px;"></div>
  <form id="newForm" onsubmit="return false;" >
    <div class="row">
      <div class="col-lg-10 col-lg-offset-1">
        <!-- /input-group -->
        <span class="label label-default" for="query">Input keyword here: </span>
        <div class="input-group">
          <input type="text" class="form-control" id="profile" name="profile" value="Chelsea">
          <span class="input-group-btn">
            <button class="btn btn-primary" id="writeProfile">Write profile!</button>
          </span>
        </div>
      </div>
      <!-- /.col-lg-6 -->
    </div>
  </form>
  <script>
    var sendButton3 = document.getElementById('writeProfile');
    sendButton3.onclick = sendData3;
    function sendData3() {
      var form = document.getElementById('newForm');
      sendAjaxQuery3('/', JSON.stringify($('form').serializeObject()));
    }
    function sendAjaxQuery3(url, data) {
      $.ajax({
        url: url + 'profile.html',
        data: data,
        dataType: 'json',
            type: 'POST', //timeout: 10000,

            success: function(data) { //使用$.each方法遍历返回的数据date,插入到id为#result中
              //console.info(data);
              var ret = JSON.stringify(data);
              var coordinate = JSON.parse(ret).geo;
              var places = [];
              for(var x=1; x<coordinate.length+1; x++)
              {
                //alert('started: '+coordinate.length);
                //alert('started: '+coordinate[0]);
                //var co = coordinate[x-1];
                var location = ['place', coordinate[x-1][0], coordinate[x-1][1], x];
                places.push(location);
                alert(places);
                initMap(places);
              }
              alert('finished');
            },
            error: function(xhr, status, error) {
              alert('Error: ' + error.message);
            }
          });
    }


    $.fn.serializeObject = function() {
      var o = {};
      var a = this.serializeArray();
      $.each(a, function() {
        if (o[this.name] !== undefined) {
          if (!o[this.name].push) {
            o[this.name] = [o[this.name]];
          }
          o[this.name].push(this.value || '');
        } else {
          o[this.name] = this.value || '';
        }
      });
      return o;
    };


    function initMap(places) {
      var map = new google.maps.Map(document.getElementById('map'), {
        center: {
          lat: 55.3781,
          lng: 0.4360
        },
        zoom: 5
      });
      var infoWindow = new google.maps.InfoWindow({
        map: map
      });

      // Try HTML5 geolocation.
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
          var pos = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };

          infoWindow.setPosition(pos);
          infoWindow.setContent('Location found.');
          map.setCenter(pos);
        }, function() {
          handleLocationError(true, infoWindow, map.getCenter());
        });
      } else {
        // Browser doesn't support Geolocation
        handleLocationError(false, infoWindow, map.getCenter());
      }
      //setMarkers(map);
      for (var i = 0; i < places.length; i++) {
        var place = places[i];
        var marker = new google.maps.Marker({
          position: {
            lat: place[1],
            lng: place[2]
          },
          map: map,
          title: place[0],
          zIndex: place[3]
        });
      }
    }


    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
      infoWindow.setPosition(pos);
      infoWindow.setContent(browserHasGeolocation ?
        'Error: The Geolocation service failed.' :
        'Error: Your browser doesn\'t support geolocation.');
    }
    /*
    var places = [
    ['Bondi Beach', 55.3781, 1.274856, 4],
    ['Coogee Beach', 55.3781, 2.259052, 5],
    ['Cronulla Beach', 50.3781, 5, 3],
    ['Manly Beach', 45.3781, 3.5, 2],
    ['Maroubra Beach', 52.3781, 4.4, 1]
    ];
*/
    function setMarkers(map) {
      
    }
  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCaR_5uJ06_W8tn8Z33OgT9mHrzDHACP38&callback=initMap">
  </script>
</body>

</html>
